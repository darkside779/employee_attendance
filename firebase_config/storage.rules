rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Employee images - only admin can upload/delete, others can read
    match /employee_images/{imageId} {
      // Admin can do everything
      allow read, write: if request.auth != null && 
        getUserRole(request.auth.uid) == 'admin';
      
      // Others can read images (for face recognition)
      allow read: if true;
    }
    
    // Company assets - only admin can manage
    match /company_assets/{assetId} {
      allow read, write: if request.auth != null && 
        getUserRole(request.auth.uid) == 'admin';
      
      // Others can read company assets
      allow read: if request.auth != null;
    }
    
    // Reports folder - admin and accounting can manage
    match /reports/{reportId} {
      allow read, write: if request.auth != null && 
        (getUserRole(request.auth.uid) == 'admin' || 
         getUserRole(request.auth.uid) == 'accounting');
    }
    
    // Temp uploads folder for face recognition
    match /temp_uploads/{userId}/{fileName} {
      allow read, write: if true; // Allow temporary uploads for face recognition
    }
  }
  
  // Helper function to get user role
  function getUserRole(userId) {
    return firestore.get(/databases/(default)/documents/users/$(userId)).data.role;
  }
}
